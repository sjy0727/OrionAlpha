### OrionAlpha

#### 一个 Nexon 游戏副本模拟器项目

---

### 资源

* 您可以从 [这里](https://mega.nz/file/at1HWAJL#llOeHFj3DLTvdG4RgMQWvveil1_rZ1pjX9dxKwshOkg) 下载游戏和客户端
* 为了在客户端中模拟日语环境，您可以从 [这里](https://mega.nz/#!T5t00IwA!YByix3DVt-_Pi0IpU-OwUnvhCDyZEPz4JQ6S-kbYHks) 下载
  LocaleEmulator
* 您可以从 [这里](https://mega.nz/file/jg1mHB4D#Q8LkkLupi1AaoRQoVmwKwulk0TzRvtMvGRqMC11Y1sk) 下载已命名的客户端 IDB 文件

### 需求/依赖项

* Java JDK（11 或更高版本）
* jakarta.json（1.1.6 或 Java EE）
* Netty（4.1.31 或更高版本）
* HikariCP（3.1.0 或更高版本）
* MariaDB Connector/J（2.2.3 或更高版本）
* slf4j（1.7.4 或更高版本）
* Jython（2.7.1 或更高版本）
* favr.lib.BCrypt（0.9.0 或更高版本）

### 构建

```bash
$ mvn package -f pom.xml
```

---

### 架构

OrionAlpha 模拟器分为两部分：*登录* 和 *游戏*，每一部分都在自己的线程上运行。

**登录** 是中央服务器，它将连接到每个世界，并可以让你在各世界间迁移。

**游戏** 设计为每个小区，通过 JVM 参数 `-DgameID=X` 来定义它是哪个小区。控制小区的每个 Game JVM 还会控制该小区的所有频道（因此，不需要多
JVM）。

---

### 服务器配置

在模拟器的根目录中有几个配置文件：

* Game0、Game1 等用于配置每个世界。
* Login 用于配置登录服务器。
* Shop 用于配置商城。
* Database 用于配置数据库连接。

配置是在 JSON 中完成的；每个属性定义为键（字符串），以及值（整数或字符串）。
以下将进一步解释大多数使用的属性定义。

Login/Game/Shop:

* `port` → 服务器连接接收器绑定的端口。
* `centerPort` → 登录服务器的私有端口，用于连接 JVM。
* `PublicIP` → 用户连接的公共 IP 地址。
* `PrivateIP` → 连接 JVM 的私有 IP 地址。

Database:

* `dbPort` → 连接到数据库的端口。
* `dbGameWorld` → 模拟器连接的活动数据库的模式名称。
* `dbGameWorldSource` → 连接到数据库的 IP/主机名。
* `dbGameWorldInfo` → 数据库的用户名/密码，用逗号分隔。（例如 "root,password"）

Game:

* `gameWorldId` → 世界的 ID（0 = Scania，1 = Bera 等）。
* `channelNo` → 世界的频道数量。
* `incExpRate` → 服务器的经验率修改器。我们使用 Nexon 的标准。（例如 100 = 1x，250 = 2.5x 等）
* `incMesoRate` → 服务器的金币爆率修改器（Nexon 标准）。
* `incDropRate` → 服务器的物品爆率修改器（Nexon 标准）。
* `worldName` → 世界的名称。此名称将发送并显示在登录服务器上。

### 启动服务器

```shell
# 初始化数据库
$ cat sql/OrionAlpha.sql sql/friends.sql sql/pets.sql sql/shop.sql | mysql -u username -p database_name
```

```shell
# 服务器启动顺序为 Login->Game->Shop
$ bash launch_login.sh
$ bash launch_game0.sh
$ bash launch_shop.sh
```

---

### MapleStory AcGuardian 绕过

Wizet 在这个客户端中加入了大量的安全检查，与 KMS Beta 不同，**这个客户端需要绕过**。

| 描述                                                  | 地址       | 指令           |
|-----------------------------------------------------|----------|--------------|
| 去除 MapleStoryAcGuardian 事件的激活                       | 005D147D | JMP 005D14B7 |
| 去除当前模块及其目录中的每个 DLL 的 CRC 初始化                        | 005D15C5 | NOP          |
| 去除随机 5-10 秒时钟上的三种不同的 CRC 检查                         | 004FC0D0 | RET          |
| 去除 MapleStoryAcGuardian 事件的创建                       | 005D37FA | NOP          |
| 去除 CSecurityThread::Update 线程启动函数                   | 005D3801 | NOP          |
| 去除来自 CWvsApp::InitializeResMan 的 CRC 完整性检查          | 005D4664 | JMP 005D4670 |
| 去除来自 CWvsApp::CallUpdate 的 CSecurityThread ack 超时检查 | 005D5511 | NOP          |

---

### 客户端修改

即使我们知道在这么早期的版本中几乎没有什么可编辑的内容，以下是一些有用的客户端修改。

### 修改 IP

如果您打算使用 OrionAlpha，您可以在我们的客户端或干净客户端中更改 IP。

* 我们的客户端默认 IP 是 `127.0.0.1`
* Nexon 的默认 IP 是 `220.90.204.122`

### 修改聊天框Welcome标语

* 将地址 `0065CB0C` 处的字符串自行修改即可，最多不超过34个字节

### 日语操作系统 CP 检查绕过

允许您在非日语操作系统上运行游戏客户端。

* 将地址 `005D14CA` 处的指令改为 `je 005D15BA`
* 将地址 `005D14D7` 处的指令改为 `je 005D15BA`

### 启用多客户端

允许多个客户端同时打开/执行。

* 将地址 `005D14CA` 处的指令改为 `jmp 005D15BA`

### 启用窗口模式

强制客户端仅以窗口模式运行，而不是全屏。

* 将地址 `005D47AE` 处的指令改为 `mov dword ptr [esp+0x84], 0x0`

### 修改客户端分辨率

允许您使游戏尺寸更大，例如 1024x768。

* 将地址 `005D487C` 处的指令改为 `push 0x320` 其中 `0x320` 是宽度
* 将地址 `005D486D` 处的指令改为 `push 0x258` 其中 `0x258` 是高度

### 激活聊天重复绕过

允许您在聊天中发送相同的消息超过三次而不会出现问题。

* 将地址 `0044D376` 处的指令改为 `jmp 0044D38A`

### 激活聊天刷屏绕过

允许您连续刷消息而不必等待 2 秒。

* 将地址 `0044D401` 处的指令改为 `jmp 0044D45D`

### 启用无限文本

允许您在一个消息中输入任意数量的字符。

* 将地址 `0054DC2C` 处的指令改为 `mov dword ptr [esp+0xC0], 0xFF` 其中 `0xFF` 是最大值

### 启用脏话过滤

允许您输入脏话而不出现弹出窗口限制您的消息发送。

* 将地址 `0044D2E2` 处的指令改为 `jmp 0044D308`

### 启用可丢弃的 NX 物品

允许您像处理其他物品一样丢弃现金 NX 物品。

* 将地址 `0048613B` 处的指令改为 `nop`
* 将地址 `00486147` 处的指令改为 `nop`

### 重新启用管理员操作

恢复 GM/管理员丢弃物品、金币等的能力。

| Action | 地址       | 指令           |
|--------|----------|--------------|
| 丢弃物品   | 004860AF | jmp 004860CA |
| 丢弃金币   | 0052A0BC | jmp 0052A0F1 |
| 创建玩家商店 | 005E0681 | jmp 005E06B1 |
| 启用交易请求 | 00497604 | jmp 00497633 |

### 启用商城

允许您访问商城。此功能在测试版客户端中被强制禁用。

* 将地址 `0054D590` 处的指令改为 `nop`
* 将地址 `0054D591` 处的指令改为 `nop`

### 修复宠物

Nexon 自 2003 年以来一直是个梗？令人惊叹。这修复了由于路径解析失败导致的宠物动作渲染崩溃。

* 将地址 `00648600` 处的 ASCII 改为 `Item/Pet/%07d.img`

### 修复信使

Nexon 忽略了信使的扩展实现，所以无法渲染头像。这修复了头像的 UI。

* 将地址 `0052F830` 处的指令改为 `nop`
* 将地址 `00531326` 处的指令改为 `nop`
* 将地址 `00532849` 处的指令改为 `nop`
* 将地址 `0052FEEA` 处的指令改为 `nop`
* 将地址 `00531036` 处的指令改为 `nop`
* 将地址 `00530E2A` 处的指令改为 `nop`
* 将地址 `00530E2C` 处的指令改为 `nop`

### 修改伤害上限

允许您将伤害上限扩展至最多 `32,767`。

* 将地址 `00617480` 处的指令改为 `13337.0` 其中 `13337.0` 是新的上限

### 修改金币上限

允许您丢弃超过 50,000 的金币包，通过设置一个新的上限。

* 将地址 `0052A1A0` 处的指令改为 `cmp eax, 0xC350` 其中 `0xC350` 是新的最大值
* 将地址 `0052A1A7` 处的指令改为 `cmp eax, 0xC350` 其中 `0xC350` 是新的最大值

---

# RageZone

更新（2024 年 2 月 20 日） - OrionAlpha 现在可用作多用途 beta 模拟器，支持 KMS v1.21、KMS v1.23 和 JMS v0.20。随着更多 beta
客户端的出现，我会尽力为每个客户端添加支持。

到目前为止，OrionAlpha 一直是我在 MapleStory 开发中最喜欢的项目之一。在我找到这些旧的封闭 alpha
视频后，它成为了我真正想玩的游戏客户端。幸运的是，一个客户端以某种方式存在！

这个模拟器是在 sunnyboy 和 Arnah 的帮助下从头编写的——与这里的其他模拟器不同，这个模拟器旨在复制 Nexon
官方源文件的结构。虽然我没有耐心将它构建成一个真正的多 JVM 环境，但转换起来并不难，因为我们已经使用它了。

```text
那么，KMS 1.23 有什么不同？这里有一些有趣的东西：

- 此客户端太旧，甚至还没有保护措施。没有任何安全性或反逆向功能。
- 这是唯一一款没有任何 AES 或 Shanda 加密的 MapleStory 客户端。事实上，它使用了自己独特的 XOR 加密，而我发现其他客户端都没有这种加密。
- StringPool 尚不存在。所有字符串都直接硬编码到应用程序中。
- 与 GMS 客户端不同，这确实是目前唯一的只开放到二转的客户端。其他客户端都实现了三转，即使它很久以前不存在。
- 角色表情尚不存在。功能键（F1~F12）不起作用。最初这些键用于操作，后来 Nexon 对其进行了更新。呕吐的情绪已经存在，但在客户端中尚不起作用。
- 键盘配置尚不存在。所有角色键都是硬编码的。这意味着 CTRL 是攻击，ALT 是跳跃，Z 是拾取，M 是小地图。
- 组队、好友和家族都还不存在。这在 GMS 客户端的早期阶段就已实现，但目前尚未实现。
- 任务系统尚不存在（技术上）。它们的 UI 窗口显示在系统菜单中，但已硬编码为禁用。不存在与数据包相关的任务功能，因此一切都基于
  NPC。游戏中几乎所有编写脚本的 NPC 都是“编写脚本”的，因为它们是任务。即便如此，在游戏文件中，脚本属性是通过键“任务”（后来更改为脚本）定义的。
- 现金物品是 其他 和 消耗 物品。这在旧的 GMS 客户端中仍然存在，但很快就发生了变化。
- 这是唯一包含 Wizet 原始登录 UI 的客户端。它具有完全不同的登录面板、世界选择、角色选择，甚至创作。事实上，在此之后的几个版本中，UI
  已更改为您在所有其他未来版本中看到的 UI。
- NPC 商店数据直接来自游戏文件中的 NPC
- 名称和描述存在于游戏文件中的实体上，而不是 String.wz。
- 这是少数包含 Wizet 原始六边形 UI（我个人最喜欢的）的客户端之一。
- 此客户端是第一批（如果不是第一个）包含现金商店系统的客户端之一。 UI 没有太大变化。
- 几乎所有的 UI 都是独一无二的，例如交易。
- 在 MapleStory 的未来版本中，此客户端的所有旧 UI 元素都包含在 WZ 文件中。 Nexon 从未删除（或更新）这些元素。此外，小游戏 UI
  和其他内容都是基于此客户端 UI重新设计的。
- 这里可能还有很多怀旧事实我可能没有注意到，但你明白了 - 这个版本是独一无二的！
```

OrionAlpha 的实现基本完成。客户端中存在的操作码不到 100 个，但都已实现。数据库操作、游戏功能、现金商店功能等都已实现。我们通过使用
FieldSplits 来使用 Nexon 的 Field 处理标准。所有数据包仅发送给您分片内的用户，而不是地图。这就是用户在分片之间迁移的方式，当他们超出小地图的范围时，看起来就像他们已经离开了地图。我们还使用
Nexon 的 Life 处理标准。通过使用 HeapBase，我们拥有 100% 类似 GMS 的控制器（NPC 和 Mobs 如何对您的角色产生仇恨），以及对整体
mob 容量的计算。在整个源代码中，我们的名称、功能和类结构均基于 Nexon 的官方服务器文件和资源。如果您需要在客户端 PDB
中更新数据包（或找到它们）并将其与我们的数据包匹配，您将始终在完全相同的位置找到它们——易于更新，易于维护。将 OrionAlpha 视为
Orion 的修改版——我从 Orion 中获取了大多数系统来在这里使用它们。说到 Orion，我们将在 2020 年重新推出——欢迎随时访问我们的
Discord！

这并不意味着 OrionAlpha 是完美的，它远非完美。不幸的是，我们从未修复过我们忽略的任何错误，也没有完成一些幕后功能。还有很多我想重写的东西（我们的
JVM 架构、数据库处理和数据文件加载），但从未完成过。我还决定不根据要求将 Orion 的完整伤害计算（CalcDamage）实现到其中。关于缺少的内容，OrionAlpha
中唯一缺少的东西与 Orion
中缺少的东西相同——我最大的敌人，脚本！我已经四处走访，并为任何希望进一步编写脚本的人建模。每个脚本都已记录并启动。由于我们不知道任务是如何工作的（假设它们还不存在），我们从未为它们编写后端实现。

所以，设置 OrionAlpha.. 好吧，如果你知道如何配置 Nexon 的官方服务器文件（嘿嘿，嗨 Darter
xd），那么设置我们的服务器将非常容易！为了更容易，我已经包含了你需要的所有文件以及所有可能的属性。如果您打算创建一个公共服务器，您需要做的就是更改
IP 配置（以及任何其他费率设置等）。别担心——我已经在 git 上记录了所有这些，以方便您使用！我们建议您安装 JDK 11（或更高版本）。您需要使用
IDE 编译源代码（我们更喜欢 IntelliJ，但 Eclipse 或 NetBeans 也可以）。最后，您需要一个 MySQL 客户端。我只是使用旧的 MySQL
查询浏览器并且拒绝改变，但是您可以使用任何您喜欢的东西，只要它可以创建新的模式并执行查询。

说到 git，以下是 OrionAlpha 所需的一切：https://github.com/EricSoftTM/OrionAlpha

由于我基本上是这里的客户端黑客，如果没有客户端编辑，OrionAlpha 有什么用呢？我还在 git 上记录了 OrionAlpha
可用的所有客户端编辑 - 这解释了编辑的作用、它们在客户端中的地址以及将它们更改为什么。以下客户端逆向可用：

* 多客户端
* 窗口模式
* 自定义分辨率
* 重复聊天绕过
* 聊天垃圾邮件绕过
* 无限聊天文本
* 脏话过滤器
* 删除 Nexon 广告
* 可丢弃 NX
* 自定义伤害上限
* 自定义 Meso 上限
* 管理员客户端限制绕过

我相信就这些了。你需要的一切都可以在 git 上找到。我已包含完整的游戏客户端、我个人命名的 IDB（无论我使用它做什么），甚至还有
LocaleEmulator，这样你就可以查看破损 ASCII 之外的文本（请记住，这是一个韩语测试版！）

# 截图：