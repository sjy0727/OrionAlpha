### OrionAlpha

#### 一个 Nexon 游戏副本模拟器项目

---

### 资源

* 您可以从 [这里](https://mega.nz/file/at1HWAJL#llOeHFj3DLTvdG4RgMQWvveil1_rZ1pjX9dxKwshOkg) 下载游戏和客户端
* 为了在客户端中模拟日语环境，您可以从 [这里](https://mega.nz/#!T5t00IwA!YByix3DVt-_Pi0IpU-OwUnvhCDyZEPz4JQ6S-kbYHks) 下载
  LocaleEmulator
* 您可以从 [这里](https://mega.nz/file/jg1mHB4D#Q8LkkLupi1AaoRQoVmwKwulk0TzRvtMvGRqMC11Y1sk) 下载已命名的客户端 IDB 文件

### 需求/依赖项

* Java JDK（11 或更高版本）
* jakarta.json（1.1.6 或 Java EE）
* Netty（4.1.31 或更高版本）
* HikariCP（3.1.0 或更高版本）
* MariaDB Connector/J（2.2.3 或更高版本）
* slf4j（1.7.4 或更高版本）
* Jython（2.7.1 或更高版本）
* favr.lib.BCrypt（0.9.0 或更高版本）

---

### 架构

OrionAlpha 模拟器分为两部分：*登录* 和 *游戏*，每一部分都在自己的线程上运行。

**登录** 是中央服务器，它将连接到每个世界，并可以让你在各世界间迁移。

**游戏** 设计为每个世界，通过 JVM 参数 `-DgameID=X` 来定义它是哪个世界。控制世界的每个 Game JVM 还会控制该世界的所有频道（因此，不需要多
JVM）。

---

### 服务器配置

在模拟器的根目录中有几个配置文件：

* Game0、Game1 等用于配置每个世界。
* Login 用于配置登录服务器。
* Shop 用于配置现金商店。
* Database 用于配置数据库连接。

配置是在 JSON 中完成的；每个属性定义为键（字符串），以及值（整数或字符串）。
以下将进一步解释大多数使用的属性定义。

Login/Game/Shop:

* `port` → 服务器连接接收器绑定的端口。
* `centerPort` → 登录服务器的私有端口，用于连接 JVM。
* `PublicIP` → 用户连接的公共 IP 地址。
* `PrivateIP` → 连接 JVM 的私有 IP 地址。

Database:

* `dbPort` → 连接到数据库的端口。
* `dbGameWorld` → 模拟器连接的活动数据库的模式名称。
* `dbGameWorldSource` → 连接到数据库的 IP/主机名。
* `dbGameWorldInfo` → 数据库的用户名/密码，用逗号分隔。（例如 "root,password"）

Game:

* `gameWorldId` → 世界的 ID（0 = Scania，1 = Bera 等）。
* `channelNo` → 世界的频道数量。
* `incExpRate` → 服务器的经验率修改器。我们使用 Nexon 的标准。（例如 100 = 1x，250 = 2.5x 等）
* `incMesoRate` → 服务器的梅索率修改器（Nexon 标准）。
* `incDropRate` → 服务器的掉落率修改器（Nexon 标准）。
* `worldName` → 世界的名称。此名称将发送并显示在登录服务器上。

---

### MapleStory AcGuardian 绕过

Wizet 在这个客户端中加入了大量的安全检查，与 KMS Beta 不同，**这个客户端需要绕过**。

| 描述                                                  | 地址       | 指令           |
|-----------------------------------------------------|----------|--------------|
| 去除 MapleStoryAcGuardian 事件的激活                       | 005D147D | JMP 005D14B7 |
| 去除当前模块及其目录中的每个 DLL 的 CRC 初始化                        | 005D15C5 | NOP          |
| 去除随机 5-10 秒时钟上的三种不同的 CRC 检查                         | 004FC0D0 | RET          |
| 去除 MapleStoryAcGuardian 事件的创建                       | 005D37FA | NOP          |
| 去除 CSecurityThread::Update 线程启动函数                   | 005D3801 | NOP          |
| 去除来自 CWvsApp::InitializeResMan 的 CRC 完整性检查          | 005D4664 | JMP 005D4670 |
| 去除来自 CWvsApp::CallUpdate 的 CSecurityThread ack 超时检查 | 005D5511 | NOP          |

---

### 客户端修改

即使我们知道在这么早期的版本中几乎没有什么可编辑的内容，以下是一些有用的客户端修改。

### 修改 IP

如果您打算使用 OrionAlpha，您可以在我们的客户端或干净客户端中更改 IP。

* 我们的客户端默认 IP 是 `127.0.0.1`
* Nexon 的默认 IP 是 `220.90.204.122`

### 日语操作系统 CP 检查绕过

允许您在非日语操作系统上运行游戏客户端。

* 将地址 `005D14CA` 处的指令改为 `je 005D15BA`
* 将地址 `005D14D7` 处的指令改为 `je 005D15BA`

### 启用多客户端

允许多个客户端同时打开/执行。

* 将地址 `005D14CA` 处的指令改为 `jmp 005D15BA`

### 启用窗口模式

强制客户端仅以窗口模式运行，而不是全屏。

* 将地址 `005D47AE` 处的指令改为 `mov dword ptr [esp+0x84], 0x0`

### 修改客户端分辨率

允许您使游戏尺寸更大，例如 1024x768。

* 将地址 `005D487C` 处的指令改为 `push 0x320` 其中 `0x320` 是宽度
* 将地址 `005D486D` 处的指令改为 `push 0x258` 其中 `0x258` 是高度

### 激活聊天重复绕过

允许您在聊天中发送相同的消息超过三次而不会出现问题。

* 将地址 `0044D376` 处的指令改为 `jmp 0044D38A`

### 激活聊天刷屏绕过

允许您连续刷消息而不必等待 2 秒。

* 将地址 `0044D401` 处的指令改为 `jmp 0044D45D`

### 启用无限文本

允许您在一个消息中输入任意数量的字符。

* 将地址 `0054DC2C` 处的指令改为 `mov dword ptr [esp+0xC0], 0xFF` 其中 `0xFF` 是最大值

### 启用脏话过滤

允许您输入脏话而不出现弹出窗口限制您的消息发送。

* 将地址 `0044D2E2` 处的指令改为 `jmp 0044D308`

### 启用可丢弃的 NX 物品

允许您像处理其他物品一样丢弃现金 NX 物品。

* 将地址 `0048613B` 处的指令改为 `nop`
* 将地址 `00486147` 处的指令改为 `nop`

### 重新启用管理员操作

恢复 GM/管理员丢弃物品、梅索等的能力。
Action | 地址 | 指令
----------- | ------- | -----------
丢弃物品 | 004860AF | jmp 004860CA
丢弃梅索 | 0052A0BC | jmp 0052A0F1
创建玩家商店 | 005E0681 | jmp 005E06B1
启用交易请求 | 00497604 | jmp 00497633

### 启用现金商店

允许您访问现金商店。此功能在测试版客户端中被强制禁用。

* 将地址 `0054D590` 处的指令改为 `nop`
* 将地址 `0054D591` 处的指令改为 `nop`

### 修复宠物

Nexon 自 2003 年以来一直是个梗？令人惊叹。这修复了由于路径解析失败导致的宠物动作渲染崩溃。

* 将地址 `00648600` 处的 ASCII 改为 `Item/Pet/%07d.img`

### 修复信使

Nexon 忽略了信使的扩展实现，所以无法渲染头像。这修复了头像的 UI。

* 将地址 `0052F830` 处的指令改为 `nop`
* 将地址 `00531326` 处的指令改为 `nop`
* 将地址 `00532849` 处的指令改为 `nop`
* 将地址 `0052FEEA` 处的指令改为 `nop`
* 将地址 `00531036` 处的指令改为 `nop`
* 将地址 `00530E2A` 处的指令改为 `nop`
* 将地址 `00530E2C` 处的指令改为 `nop`

### 修改伤害上限

允许您将伤害上限扩展至最多 `32,767`。

* 将地址 `00617480` 处的指令改为 `13337.0` 其中 `13337.0` 是新的上限

### 修改梅索上限

允许您丢弃超过 50,000 的梅索包，通过设置一个新的上限。

* 将地址 `0052A1A0` 处的指令改为 `cmp eax, 0xC350` 其中 `0xC350` 是新的最大值
* 将地址 `0052A1A7` 处的指令改为 `cmp eax, 0xC350` 其中 `0xC350` 是新的最大值